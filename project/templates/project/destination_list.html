{% extends 'project/base.html' %}

{% block title %}Destinations - Travel Booking System{% endblock %}

{% block content %}
<h1>Travel Destinations</h1>

<div class="search-filter-section">
    <form method="get" class="filter-form">
        <div class="form-group">
            <input type="text" name="search" class="search-input" placeholder="Search destinations..." value="{{ search_query }}">
        </div>
        <div class="form-group">
            <select name="country" class="form-control">
                <option value="">All Countries</option>
                {% for country in countries %}
                    <option value="{{ country }}" {% if country == country_filter %}selected{% endif %}>{{ country }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Filter</button>
            <a href="{% url 'destination-list' %}" class="btn btn-secondary">Clear</a>
        </div>
    </form>
</div>

<div style="margin-bottom: 1.5rem;">
    <a href="{% url 'destination-create' %}" class="btn btn-success">Add New Destination</a>
</div>

<div class="card-grid">
    {% for destination in destinations %}
    <div class="card">
        <h3>{{ destination.name }}</h3>
        <p><strong>Country:</strong> {{ destination.country }}</p>
        <p>{{ destination.description|truncatewords:40 }}</p>
        <p style="font-size: 0.9rem; color: #666;">
            <strong>Packages available:</strong> {{ destination.packages.count }}
        </p>
        <div class="btn-group">
            <a href="{% url 'destination-detail' destination.pk %}" class="btn btn-primary">View Details</a>
            <a href="{% url 'destination-update' destination.pk %}" class="btn btn-warning">Edit</a>
            <a href="{% url 'destination-delete' destination.pk %}" class="btn btn-danger">Delete</a>
        </div>
    </div>
    {% empty %}
    <p>No destinations found.</p>
    {% endfor %}
</div>

{% if is_paginated %}
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page=1">First</a>
        <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
    {% endif %}

    <span class="current">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Next</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">Last</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
